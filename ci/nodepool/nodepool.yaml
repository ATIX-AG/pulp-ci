script-dir: /home/pulp/pulp_packaging/ci/nodepool/scripts/

# empty dir, stops nodepool from throwing a traceback on start
images-dir: /etc/nodepool/images

dburi: 'postgresql:///nodepool'

zmq-publishers:
  - tcp://pulp-jenkins.rhev-ci-vms.eng.rdu2.redhat.com:8881

cron:
  # try to get images updated before nightlies run
  image-update: '0 21 * * *'
  cleanup: '*/1 * * * *'

labels:
  - name: pulp-smash-np
    image: f23-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f23-np
    image: f23-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f23-vanilla-np
    image: f23-vanilla-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f23-docker-np
    image: f23-docker-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f24-np
    image: f24-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f24-vanilla-np
    image: f24-vanilla-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f25-np
    image: f25-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: f25-vanilla-np
    image: f25-vanilla-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: rhel6-np
    image: rhel6-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: rhel6-vanilla-np
    image: rhel6-vanilla-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: rhel7-np
    image: rhel7-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh
  - name: rhel7-vanilla-np
    image: rhel7-vanilla-np
    min-ready: 0
    providers:
      - name: cios
    ready-script: fix_hostname.sh

providers:
  - name: cios
    cloud: cios
    # The current quota allows for 40 VCPUs. The nodepool VM itself uses 2 of
    # those, leaving 38. Each slave uses 2 VCPUs, which gives us a max of 19
    # nodepool slaves. Then, subtract 1 so there's always room for nodepool to
    # build an image if needed.
    max-servers: 18
    boot-timeout: 240
    launch-timeout: 900
    pool: "10.8.180.0/22"
    clean-floating-ips: true
    images:
      - name: f23-np
        base-image: Fedora-Cloud-Base-23-20151113-py27.x86_64
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
      - name: f23-vanilla-np
        base-image: Fedora-Cloud-Base-23-20151113-py27.x86_64
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
      - name: f23-docker-np
        base-image: Fedora-Cloud-Base-23-20151113-py27.x86_64
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
      - name: f24-np
        base-image: Fedora-Cloud-Base-24-1.2.x86_64
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
      - name: f24-vanilla-np
        base-image: Fedora-Cloud-Base-24-1.2.x86_64
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
      - name: f25-np
        base-image: Fedora-Cloud-Base-25-compose-latest
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
      - name: f25-vanilla-np
        base-image: Fedora-Cloud-Base-25-compose-latest
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 3072
        # for rhel images, the "updated" images should require less updating
        # than the "released" images: https://mojo.redhat.com/docs/DOC-1081665
        # rhel6 images need the t2.medium image type because their initrd
        # explodes on the ephemeral volumes
      - name: rhel6-np
        base-image: rhel-6.8-server-x86_64-updated
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 4096
        name-filter: t2.medium
      - name: rhel6-vanilla-np
        base-image: rhel-6.8-server-x86_64-updated
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 4096
        name-filter: t2.medium
      - name: rhel7-np
        base-image: rhel-7.3-server-x86_64-updated
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 4096
      - name: rhel7-vanilla-np
        base-image: rhel-7.3-server-x86_64-updated
        username: jenkins
        setup: prepare_node.sh
        private-key: /etc/nodepool/pulp_rsa
        min-ram: 4096
targets:
  - name: pulp-jenkins
